<!--home.wxml-->
<wxs src="../../utils/formatter.wxs" module="formatter">
</wxs>
<view class="page">
  <view class="userinfo">
    <button class="loginButton" type="primary" plain="true" wx:if="{{!hasUserInfo}}" open-type="getUserInfo" bindgetuserinfo="getUserInfo">
      登录
    </button>
    <view wx:else class="myInfoCard">
      <image class="userinfo-avatar" src="{{userInfo.avatarUrl}}" mode="cover"></image>
      <view class="userinfoRightSection">
        <view class="userinfo-nickname">{{userInfo.nickName}}</view>
        <view class="userinfoCredits">
          <view>{{totalPoints}}</view>
          <view class="userinfoPointsDetail">
            <navigator url="pointsDetail?userId={{userInfo.id}}">Credits</navigator>
            <image src="../../images/right_arrow1.png" class="navIcon"></image>
          </view>
        </view>
      </view>
    </view>
  </view>
  <view class="page__bd">
    <view class="weui-tab">
      <view class="weui-navbar">
        <block wx:for="{{tabs}}" wx:key="*this">
          <view id="{{index}}" class="weui-navbar__item {{activeIndex == index ? 'weui-bar__item_on' : ''}}" bindtap="tabClick">
            <view class="weui-navbar__title">{{item}}</view>
          </view>
        </block>
        <view class="weui-navbar__slider" style="left: {{sliderLeft}}px; transform: translateX({{sliderOffset}}px); -webkit-transform: translateX({{sliderOffset}}px);"></view>
      </view>
      <view class="weui-tab__panel">
        <!-- Learning -->
        <view class="weui-tab__content" hidden="{{activeIndex != 0}}">
          <view wx:if="{{learnSessionsIsPullDownLoading}}" class="weui-loadmore">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">Loading</view>
          </view>
          <view id="{{item.id}}" bindtap='goLearnSession' class="eventItem" wx:for="{{learnSessions}}" wx:key="id">
            <view class='leftContent'>
              <image wx:if="{{item.tileImageSrc}}" src="{{formatter.getImageUrl(item.tileImageSrc)}}"></image>
              <image wx:else src="https://img1.sycdn.imooc.com/szimg/5a9ca4e80001786305400300-360-202.jpg"></image>
            </view>
            <view class="rightContent">
              <view class="title">
                <text>{{item.topic}}</text>
              </view>
              <view class="speaker">{{item.owner.nickName}}</view>
              <view class="location">
                {{formatter.getDate(item.createdDate)}}
                <view class="count">
                  <image src="../../images/mini_people.png"></image>
                  <text>{{item.enrollments}}</text>
                </view>
              </view>
            </view>
          </view>
          <view wx:if="{{learnSessionsIsLoading}}" class="weui-loadmore">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">Loading</view>
          </view>
          <view wx:if="{{learnSessionsIsNoData}}" class="weui-loadmore weui-loadmore_line">
            <view class="weui-loadmore__tips weui-loadmore__tips_in-line">No More Data</view>
          </view>
        </view>

        <!-- Sharing -->
        <view class="weui-tab__content" hidden="{{activeIndex != 1}}">
          <view wx:if="{{ownedSessionsIsPullDownLoading}}" class="weui-loadmore">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">Loading</view>
          </view>
          <view id="{{item.id}}" bindtap='goOwnedSession' class="eventItem" wx:for="{{ownedSessions}}" wx:key="id">
            <view class='leftContent'>
              <image wx:if="{{item.tileImageSrc}}" src="{{formatter.getImageUrl(item.tileImageSrc)}}"></image>
              <image wx:else src="https://img1.sycdn.imooc.com/szimg/5a9ca4e80001786305400300-360-202.jpg"></image>
            </view>
            <view class="rightContent">
              <view class="title">
                <text>{{item.topic}}</text>
              </view>
              <view class="speaker">{{item.owner.nickName}}</view>
              <view class="location">
                {{formatter.getDate(item.createdDate)}}
                <view class="count">
                  <image src="../../images/mini_people.png"></image>
                  <text>{{item.enrollments}}</text>
                </view>
              </view>
            </view>
          </view>
          <view wx:if="{{ownedSessionsIsLoading}}" class="weui-loadmore">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">Loading</view>
          </view>
          <view wx:if="{{ownedSessionsIsNoData}}" class="weui-loadmore weui-loadmore_line">
            <view class="weui-loadmore__tips weui-loadmore__tips_in-line">No More Data</view>
          </view>
          <view wx:if="{{hasUserInfo}}" bindtap="onCreateSession" class="session-create-btn"></view>
        </view>
        <!-- Completed -->
        <view class="weui-tab__content" hidden="{{activeIndex != 2}}">
          <view wx:if="{{completedSessionsIsPullDownLoading}}" class="weui-loadmore">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">Loading</view>
          </view>
          <view id="{{item.id}}" bindtap='goCompletedSession' class="eventItem" wx:for="{{completedSessions}}" wx:key="id">
            <view class='leftContent'>
              <image wx:if="{{item.tileImageSrc}}" src="{{formatter.getImageUrl(item.tileImageSrc)}}"></image>
              <image wx:else src="https://img1.sycdn.imooc.com/szimg/5a9ca4e80001786305400300-360-202.jpg"></image>
            </view>
            <view class="rightContent">
              <view class="title">
                <text>{{item.topic}}</text>
              </view>
              <view class="speaker">{{item.owner.nickName}}</view>
              <view class="location">
                {{formatter.getDate(item.createdDate)}}
                <view class="count">
                  <image src="../../images/mini_people.png"></image>
                  <text>{{item.enrollments}}</text>
                </view>
              </view>
            </view>
          </view>
          <view wx:if="{{completedSessionsIsLoading}}" class="weui-loadmore">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">Loading</view>
          </view>
          <view wx:if="{{completedSessionsIsNoData}}" class="weui-loadmore weui-loadmore_line">
            <view class="weui-loadmore__tips weui-loadmore__tips_in-line">No More Data</view>
          </view>
        </view>
      </view>
    </view>
  </view>


  <!-- <view class="weui-cells weui-cells_after-title">
    <view class="weui-cell weui-cell_access" hover-class="weui-cell_active">
      <view class="weui-cell__hd">
        <image src="../../images/checkin.png" class="navIcon"></image>
      </view>
       <view wx:if="{{!isSessionOwner}}" class="weui-cell__bd" bindtap="checkIn">签到</view>
      <view wx:else class="weui-cell__bd" bindtap="generateCode">生成签到口令</view>
    </view> 
    <view class="weui-cell weui-cell_access" hover-class="weui-cell_active">
      <view class="weui-cell__hd">
        <image src="../../images/editing.png" class="navIcon"></image>
      </view>
      <view class="weui-cell__bd" bindtap="startExam">考试中心</view>
      <view class="weui-cell__ft weui-cell__ft_in-access"></view>
    </view>
    <view url="" class="weui-cell weui-cell_access" hover-class="weui-cell_active">
      <view class="weui-cell__hd">
        <image src="../../images/gift.png" class="navIcon"></image>
      </view>
      <view class="weui-cell__bd" bindtap="handleLotteryClick">抽奖</view>
      <view class="weui-cell__ft weui-cell__ft_in-access"></view>
    </view>
    <view class="weui-cell weui-cell_access" hover-class="weui-cell_active">
      <view class="weui-cell__hd">
        <image src="../../images/me_question.png" class="navIcon"></image>
      </view>
      <view class="weui-cell__bd" bindtap="addQuestion">添加考题</view>
      <view class="weui-cell__ft weui-cell__ft_in-access"></view>
    </view>
    <navigator url="../schedule/schedule" class="weui-cell weui-cell_access" hover-class="weui-cell_active">
      <view class="weui-cell__hd">
        <image src="../../images/calendar.png" class="navIcon"></image>  
      </view>
      <view class="weui-cell__bd">查看分享安排</view>
      <view class="weui-cell__ft weui-cell__ft_in-access"></view>
    </navigator>
    <view class="weui-cell weui-cell_access" hover-class="weui-cell_active">
      <view class="weui-cell__hd">
        <image src="../../images/logout.png" class="navIcon"></image>
      </view>
      <view class="weui-cell__bd" bindtap="logout">退出登录</view>
    </view>
  </view>
  <modal id="codeInputModal" hidden="{{isCheckinModalHidden}}" title="请输入签到口令" confirm-text="提交" cancel-text="取消" 
  bindconfirm="submitCheckinCode" bindcancel="cancelCheckin"> 
    <input bindinput="onCodeInput" type='text' placeholder="点我输入口令" value="{{checkinCode}}" />
  </modal>
  <modal id="generateCodeModal" hidden="{{isGenerateCodeModal}}" title="签到口令" cancel-text="取消" confirm-text="确定" 
  bindconfirm="saveChenkinCode" bindcancel="cancelGenerateCode"> 
  <view>
    <text>{{checkinCode}}</text>
    <button type="primary" size="mini" bindtap="changeCheckinCode">换一换</button>
  </view> 
  </modal>   -->
</view>